<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="en">
<meta name=color-scheme content="light dark">
<meta name=author content="Night">
<meta name=description content="前置条件
安装Docker及Docker Compose 安装Jenkins    新建jenkins文件夹，并添加docker-compose.yml文件
在文件中添加以下内容
version: &#34;3.9&#34; volumes: jenkins_data: { } services: jenkins: image: jenkinsci/blueocean container_name: Jenkins restart: always environment: - TZ=Asia/Shanghai //中国时区 ports: - &#34;8080:8080&#34; // 左边是外部端口 volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock 在当前文件夹下执行以下命令
// 启动jenkins服务 docker-compose up -d // 授权任意用户可访问docker sudo chmod 777 /var/run/docker.sock 等待启动完成后，执行以下命令查看密码
docker logs -f Jenkins 图上红色标注即为Jenkins密码
访问服务器ip:8080，进入jenkins，这里我是本机起的服务，直接访问http://127.0.0.1:8080/即可
输入上面红色的管理员密码
点击选择插件来安装
勾选以下插件即可
Folders Plugin Build Timeout Config File Provider Credentials Binding Plugin Timestamper Workspace Cleanup Git plugin Git Parameter SSH Build Agents Matrix Authorization Strategy Plugin Localization: Chinese (Simplified) 点击安装，等待安装完成">
<meta name=keywords content="blog,developer,personal">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Jenkins Docker实现SpringBoot自动化发布">
<meta name=twitter:description content="前置条件
安装Docker及Docker Compose 安装Jenkins    新建jenkins文件夹，并添加docker-compose.yml文件
在文件中添加以下内容
version: &#34;3.9&#34; volumes: jenkins_data: { } services: jenkins: image: jenkinsci/blueocean container_name: Jenkins restart: always environment: - TZ=Asia/Shanghai //中国时区 ports: - &#34;8080:8080&#34; // 左边是外部端口 volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock 在当前文件夹下执行以下命令
// 启动jenkins服务 docker-compose up -d // 授权任意用户可访问docker sudo chmod 777 /var/run/docker.sock 等待启动完成后，执行以下命令查看密码
docker logs -f Jenkins 图上红色标注即为Jenkins密码
访问服务器ip:8080，进入jenkins，这里我是本机起的服务，直接访问http://127.0.0.1:8080/即可
输入上面红色的管理员密码
点击选择插件来安装
勾选以下插件即可
Folders Plugin Build Timeout Config File Provider Credentials Binding Plugin Timestamper Workspace Cleanup Git plugin Git Parameter SSH Build Agents Matrix Authorization Strategy Plugin Localization: Chinese (Simplified) 点击安装，等待安装完成">
<meta property="og:title" content="Jenkins Docker实现SpringBoot自动化发布">
<meta property="og:description" content="前置条件
安装Docker及Docker Compose 安装Jenkins    新建jenkins文件夹，并添加docker-compose.yml文件
在文件中添加以下内容
version: &#34;3.9&#34; volumes: jenkins_data: { } services: jenkins: image: jenkinsci/blueocean container_name: Jenkins restart: always environment: - TZ=Asia/Shanghai //中国时区 ports: - &#34;8080:8080&#34; // 左边是外部端口 volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock 在当前文件夹下执行以下命令
// 启动jenkins服务 docker-compose up -d // 授权任意用户可访问docker sudo chmod 777 /var/run/docker.sock 等待启动完成后，执行以下命令查看密码
docker logs -f Jenkins 图上红色标注即为Jenkins密码
访问服务器ip:8080，进入jenkins，这里我是本机起的服务，直接访问http://127.0.0.1:8080/即可
输入上面红色的管理员密码
点击选择插件来安装
勾选以下插件即可
Folders Plugin Build Timeout Config File Provider Credentials Binding Plugin Timestamper Workspace Cleanup Git plugin Git Parameter SSH Build Agents Matrix Authorization Strategy Plugin Localization: Chinese (Simplified) 点击安装，等待安装完成">
<meta property="og:type" content="article">
<meta property="og:url" content="/2021/12/jenkinsdocker%E5%AE%9E%E7%8E%B0springboot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-12-25T22:06:13+08:00">
<meta property="article:modified_time" content="2021-12-25T22:06:13+08:00">
<title>
Jenkins Docker实现SpringBoot自动化发布 · NoesBlog
</title>
<link rel=canonical href=/2021/12/jenkinsdocker%E5%AE%9E%E7%8E%B0springboot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<meta name=generator content="Hugo 0.91.2">
</head>
<body class="preload-transitions colorscheme-auto">
<div class=float-container>
<a id=dark-mode-toggle class=colorscheme-toggle>
<i class="fa fa-adjust fa-fw" aria-hidden=true></i>
</a>
</div>
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
NoesBlog
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/posts/>博客</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/tags/>标签</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/about/>关于</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=/2021/12/jenkinsdocker%E5%AE%9E%E7%8E%B0springboot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83/>
Jenkins Docker实现SpringBoot自动化发布
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-12-25T22:06:13+08:00>
2021/12/25 22:06
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
One-minute read
</span>
</div>
<div class=authors>
<i class="fa fa-user" aria-hidden=true></i>
<a href=/authors/night/>Night</a></div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/jenkins/>Jenkins</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/docker/>Docker</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/springboot/>SpringBoot</a>
</span></div>
</div>
</header>
<div>
<p>前置条件</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>安装Docker及Docker Compose
</code></pre></div><h1 id=安装jenkins>
安装Jenkins
<a class=heading-link href=#%e5%ae%89%e8%a3%85jenkins>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>新建jenkins文件夹，并添加<code>docker-compose.yml</code>文件</p>
<p>在文件中添加以下内容</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>version: &#34;3.9&#34;

volumes:
  jenkins_data: { }

services:
  jenkins:
    image: jenkinsci/blueocean
    container_name: Jenkins
    restart: always
    environment:
      - TZ=Asia/Shanghai    //中国时区
    ports:
      - &#34;8080:8080&#34;         // 左边是外部端口
    volumes:
      - jenkins_data:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
</code></pre></div><p>在当前文件夹下执行以下命令</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>// 启动jenkins服务
docker-compose up -d
// 授权任意用户可访问docker
sudo chmod 777 /var/run/docker.sock
</code></pre></div><p>等待启动完成后，执行以下命令查看密码</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>docker logs -f Jenkins
</code></pre></div><p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227133343546-16405832306111.png alt=image-20211227133343546></p>
<p>图上红色标注即为Jenkins密码</p>
<p>访问服务器ip:8080，进入jenkins，这里我是本机起的服务，直接访问<code>http://127.0.0.1:8080/</code>即可</p>
<p>输入上面红色的管理员密码</p>
<p>点击选择插件来安装</p>
<p>勾选以下插件即可</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Folders Plugin
Build Timeout
Config File Provider
Credentials Binding Plugin
Timestamper
Workspace Cleanup
Git plugin
Git Parameter
SSH Build Agents
Matrix Authorization Strategy Plugin
Localization: Chinese (Simplified)
</code></pre></div><p>点击安装，等待安装完成</p>
<p>点击右下角使用admin账户继续，点击保存并完成，现在进入到Jenkins页面</p>
<h1 id=插件安装>
插件安装
<a class=heading-link href=#%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>我们还需要安装几个插件，点击Manager Jenkins，点击Manage Plugins</p>
<p>请先到以下地址下载本地化插件</p>
<p><code>https://plugins.jenkins.io/localization-zh-cn/#releases</code></p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227135012456.png alt=image-20211227135012456></p>
<p>点击高级，点击上传插件，将刚才下载的文件上传上去</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227135333448-16405844163462.png alt=image-20211227135333448></p>
<p>安装完成后勾选以重启Jenkins</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227135119702.png alt=image-20211227135119702></p>
<p>点击可选插件，搜索以下几个插件并安装，这里注意的是自带搜索比较弱智，所以直接拿一个单词搜索就行，否则不一定能搜索出来</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Generic Webhook Trigger Plugin
AdoptOpenJDK installer Plugin
Maven Integration plugin
Publish Over SSH
</code></pre></div><p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227135529715-16405845318083.png alt=image-20211227135529715></p>
<p>等待重启完成后</p>
<h1 id=jdk安装>
JDK安装
<a class=heading-link href=#jdk%e5%ae%89%e8%a3%85>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>点击系统管理，点击全局工具配置，找到JDK，点击新增JDK</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227143903388-16405871445678.png alt=image-20211227143903388></p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227143921016.png alt=image-20211227143921016></p>
<p>点击删除安装</p>
<p>点击新增安装，选择Install from adoptopenjdk.net</p>
<p>选择JDK17</p>
<h1 id=maven安装>
Maven安装
<a class=heading-link href=#maven%e5%ae%89%e8%a3%85>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<p>拉到页面最下方，找到Maven，点击新增Maven，输入名称，然后选择对应版本后点击保存</p>
<h2 id=添加自定义maven-settingsxml>
添加自定义maven settings.xml
<a class=heading-link href=#%e6%b7%bb%e5%8a%a0%e8%87%aa%e5%ae%9a%e4%b9%89maven-settingsxml>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>点击系统管理，点击Managed files，点击add a new config，选择类型为<strong>Global Maven settings.xml</strong></p>
<p>点击提交，将Content中的值改为你的maven 私服的settings.xml文件</p>
<p>点击保存</p>
<h1 id=创建流水线项目>
创建流水线项目
<a class=heading-link href=#%e5%88%9b%e5%bb%ba%e6%b5%81%e6%b0%b4%e7%ba%bf%e9%a1%b9%e7%9b%ae>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h1>
<h2 id=基础设置>
基础设置
<a class=heading-link href=#%e5%9f%ba%e7%a1%80%e8%ae%be%e7%bd%ae>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>点击新建任务，选择<code>构建一个自由风格的项目</code></p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227135858479-16405847405884.png alt=image-20211227135858479></p>
<p>勾选丢弃旧的构建，并输入保持构建的最大个数为14个，这里主要是为了避免频繁构建导致Jenkins占满硬盘</p>
<p>勾选参数化构建过程，选择Git参数，输入参数名称为branch，参数类型为分支，默认值为<code>origin/master</code>这里可以根据自己需求进行调整，例如我在项目的开发环境的时候选择的默认值为origin/dev</p>
<h2 id=源码管理>
源码管理
<a class=heading-link href=#%e6%ba%90%e7%a0%81%e7%ae%a1%e7%90%86>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>源码管理选择Git，输入你的Git仓库，这时会提示无法连接仓库，点击新增凭据</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227142624607-16405863864485.png alt=image-20211227142624607></p>
<h2 id=新增git凭据>
新增Git凭据
<a class=heading-link href=#%e6%96%b0%e5%a2%9egit%e5%87%ad%e6%8d%ae>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>点击新增凭据</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227142827078-16405865094416.png alt=image-20211227142827078></p>
<p>选择类型为带私钥的ssh用户名</p>
<p>随便输入一个用户名，私钥可选你自己的私钥，也可以选择部署密钥，注意这里这个密钥是用于访问Git仓库的密钥，必须要在对应Git仓库添加此密钥，如是GitLab则添加的密钥必须可访问此仓库</p>
<p>私钥选择直接输入，然后将你的<code>id_rsa</code>文件内容复制进去，点击保存，然后在页面选择此凭据，这时错误提示就消失了，代表Jenkins可以正确访问仓库</p>
<h2 id=maven构建项目>
Maven构建项目
<a class=heading-link href=#maven%e6%9e%84%e5%bb%ba%e9%a1%b9%e7%9b%ae>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>跳转至Build步骤，选择调用顶层shell目标</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227151129760.png alt=image-20211227151129760></p>
<p>输入构建Maven命令，这里简单解释一下 ，<code>-T 1C</code> 代表一个核心使用一个线程进行构建，clean package就是常规的清理及打包，fork=true则是打开maven多线程编译，最后一个就是跳过测试环节</p>
<p>点击高级，选择自定义的全局maven settings文件</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227151154513-164058911543710.png alt=image-20211227151154513></p>
<h2 id=docker镜像构建>
Docker镜像构建
<a class=heading-link href=#docker%e9%95%9c%e5%83%8f%e6%9e%84%e5%bb%ba>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>在构建步骤选择</p>
<p><img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227154700759-164059122294612.png alt=image-20211227154700759></p>
<p>新增一个构建步骤，选择类型为执行Shell</p>
<p>在输入框中输入以下内容</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>echo &#39;执行构建docker镜像&#39;

cd &lt;你的项目子目录，如果是单体项目，Dockerfile在顶层目录下，则不需要此步骤&gt;
docker build -t &lt;你的镜像名称&gt;:&lt;你的镜像版本，此处可使用Jenkins环境变量，例如git提交hash&gt; 构建时间等 . &amp;

// 在这里也可以执行Docker镜像推送工作或者启动Docker镜像操作
// 例如
// docker stop &lt;你的镜像名称&gt;
// docker run &lt;你的镜像名称&gt;:&lt;你的镜像版本&gt;

wait
echo &#39;docker镜像构建完成&#39;
</code></pre></div><p>点击保存，点击立即构建，即可查看构建效果</p>
<h2 id=其他问题>
其他问题
<a class=heading-link href=#%e5%85%b6%e4%bb%96%e9%97%ae%e9%a2%98>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>每次安装Jenkins都能有不同的惊喜</p>
<p>以下是整理的一些问题</p>
<p>Q：本机运行时JDK无法下载，提示连接超时或无此文件夹等问题</p>
<p>A：在JDK安装步骤选择<img src=Jenkins-Docker%E5%AE%9E%E7%8E%B0SpringBoot%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83.assets/image-20211227153617646-164059057896911.png alt=image-20211227153617646></p>
<p>解压文件方式进行安装，这里使用了<a href=https://www.injdk.cn/>Java I tell you-爪哇我话你知 (injdk.cn)</a>代理下载JDK，如果还是提示找不到目录</p>
<p>则使用</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>// 进入jenkins容器
docker exec -it Jenkins bash 

// 跳转到jdk安装目录
cd  /var/jenkins_home/tools/hudson.model.JDK/   
进入目录，将目录名称重命名为上图中解压目录的名称，例如我这里是myjdk
则执行mv jdk-17.0.1/ myjdk
</code></pre></div><p>Q：构建镜像时提示无法访问docker.sock</p>
<p>A: 将宿主机中的docker.sock设置权限为任意用户可访问(即777)，或者不使用宿主机的docker，自己自定义jenkins镜像，安装docker服务</p>
</div>
<footer>
<script src=https://utteranc.es/client.js repo=night2049/night2049.github.io issue-term=url label=comment theme=github-light crossorigin=anonymous async></script>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
©
2017 -
2022
Night
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
</body>
</html>